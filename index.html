<script>
    const layout = "888 888 888888  88  88".split('');
    const NPOINT_ID = "e5ab2c288d26e7ce23ca"; 

    async function updateScore() {
        const now = new Date().toLocaleTimeString();
        document.getElementById('last-check').textContent = now;

        try {
            // Adding a cache-buster even to the API call to force fresh data
            const response = await fetch(`https://api.npoint.io/${NPOINT_ID}?t=${Date.now()}`);
            
            if (!response.ok) {
                document.getElementById('stat').textContent = "Server Busy...";
                return;
            }

            // We check the text first to make sure it's not empty
            const rawBody = await response.text();
            if (!rawBody || rawBody.trim() === "") {
                document.getElementById('stat').textContent = "Empty Data...";
                return;
            }

            // Now we try to parse the JSON
            const data = JSON.parse(rawBody);
            
            if (data && data.score) {
                const text = data.score;
                document.getElementById('raw-data').textContent = text;
                document.getElementById('stat').textContent = "Live: Connected";

                const cleanText = text.split('');
                const r1 = document.getElementById('row1');
                const r2 = document.getElementById('row2');
                r1.innerHTML = ''; r2.innerHTML = '';
                
                layout.forEach((lChar, i) => {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    if (lChar === '8') {
                        const d = document.createElement('div');
                        d.className = 'dim'; d.textContent = '8';
                        cell.appendChild(d);
                    }
                    const sChar = cleanText[i] || " ";
                    if (sChar !== " ") {
                        const b = document.createElement('div');
                        b.className = 'bright'; b.textContent = sChar;
                        cell.appendChild(b);
                    }
                    if (i < 11) r1.appendChild(cell);
                    else r2.appendChild(cell);
                });
            }
        } catch (e) {
            document.getElementById('stat').textContent = "Syncing...";
            console.error("JSON Error:", e);
        }
    }

    setInterval(updateScore, 3000);
    window.onload = updateScore;
</script>
